<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>充值最优方案计算器（预算参考版）</title>
  <link rel="stylesheet" href="/footer.css" />
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--accent:#2563eb}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:var(--bg);color:#111}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    .card{background:var(--card);border-radius:10px;padding:14px;margin-bottom:12px;box-shadow:0 6px 18px rgba(26,33,56,0.06)}
    input[type=number]{padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    button{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #eef2ff;padding:8px;text-align:left;font-size:13px}
    .best{background:#ecfdf5}
    .insideBudget{color:green;font-weight:bold}
    .overBudget{color:red;font-weight:bold}
    @media (max-width:640px){.row{flex-direction:column;gap:8px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 12px">充值最优方案计算器（预算参考版）</h1>

    <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <input id="budgetInput" type="number" value="550" style="width:130px" />
      <input id="accumTargetInput" type="number" value="100000000" style="width:220px" />
      <button id="calcBtn">计算</button>
      <div style="flex:1"></div>
      <div class="muted">档位：10 / 20 / 30 / 50 / 100 / 200 / 300 / 500 / 1000 / 1500 / 2000 / 3000</div>
    </div>

    <div id="plansContainer"></div>
    <div id="rankingContainer"></div>

    <div class="muted" style="margin-top:8px">说明：所有方案均计算最终钻石（含奖励），按钻石数量排序，并显示是否在预算内。</div>

    <!-- footer -->
    <div style="margin-top:20px" class="muted">Footer 加载区域（页面底部）</div>
    <div class="footer-wrapper"><footer id="footer-container">加载中...</footer></div>
    <script src="/load-footer.js"></script>
  </div>

  <script>
    const rechargeOptions = [
      { cost: 10, diamonds: 2000000 },
      { cost: 20, diamonds: 4000000 },
      { cost: 30, diamonds: 6000000 },
      { cost: 50, diamonds: 10000000 },
      { cost: 100, diamonds: 30000000 },
      { cost: 200, diamonds: 60000000 },
      { cost: 300, diamonds: 90000000 },
      { cost: 500, diamonds: 200000000 },
      { cost: 1000, diamonds: 500000000 },
      { cost: 1500, diamonds: 750000000 },
      { cost: 2000, diamonds: 1200000000 },
      { cost: 3000, diamonds: 2100000000 },
    ];

    const ACCUM_REWARD = 145000000;
    const CONSEC_REWARD_TOTAL = 70000000;

    function formatDiamonds(num){
      if(num >= 100000000) return (num/100000000).toFixed(2) + ' 亿';
      return Math.round(num/10000) + ' 万';
    }

    function findBestAccumCombo(target){
      const n = rechargeOptions.length;
      let best = null;
      function consider(picks){
        const totalDiamonds = picks.reduce((s,p)=>s+p.diamonds,0);
        if(totalDiamonds < target) return;
        const cost = picks.reduce((s,p)=>s+p.cost,0);
        const over = totalDiamonds - target;
        const finalWithReward = totalDiamonds + ACCUM_REWARD;
        if(!best) best = { picks, cost, totalDiamonds, over, finalWithReward };
        else {
          if(finalWithReward > best.finalWithReward) best = { picks, cost, totalDiamonds, over, finalWithReward };
          else if(finalWithReward === best.finalWithReward){
            if(cost < best.cost) best = { picks, cost, totalDiamonds, over, finalWithReward };
            else if(cost === best.cost){
              if(over < best.over) best = { picks, cost, totalDiamonds, over, finalWithReward };
              else if(over === best.over){
                if(picks.length < best.picks.length) best = { picks, cost, totalDiamonds, over, finalWithReward };
              }
            }
          }
        }
      }
      for(let i=0;i<n;i++) consider([rechargeOptions[i]]);
      for(let i=0;i<n;i++) for(let j=0;j<n;j++) consider([rechargeOptions[i],rechargeOptions[j]]);
      for(let i=0;i<n;i++) for(let j=0;j<n;j++) for(let k=0;k<n;k++) consider([rechargeOptions[i],rechargeOptions[j],rechargeOptions[k]]);
      if(!best){ const top = [rechargeOptions[n-1],rechargeOptions[n-1],rechargeOptions[n-1]]; const total = top[0].diamonds*3; best={picks:top,cost:top[0].cost*3,totalDiamonds:total,over:total-target,finalWithReward:total+ACCUM_REWARD}; }
      const days = best.picks.map((p,idx)=>({day:idx+1,option:p.cost,diamonds:p.diamonds}));
      return { cost: best.cost, diamonds: best.totalDiamonds, days, finalWithReward: best.finalWithReward };
    }

    function calculatePlans(budget,target){
      const acc = findBestAccumCombo(target);
      const accumDays = acc.days;
      const accumCost = acc.cost;

      const onlyAcc = { name:'只累计奖励 (前三天累计)', cost:accumCost, diamonds:acc.finalWithReward, efficiency:acc.finalWithReward/(accumCost*10000), schedule:accumDays, insideBudget: accumCost<=budget };

      const onlyConsec = { name:'只连续奖励 (7天每天 >=10M)', cost:350, diamonds:140000000, efficiency:140000000/(350*10000), schedule:Array.from({length:7},(_,i)=>({day:i+1,option:50,diamonds:10000000})), insideBudget:350<=budget };

      const extraDaysNeeded = Math.max(0,7-accumDays.length);
      const extraCost = extraDaysNeeded*50;
      const extraList = Array.from({length:extraDaysNeeded},(_,i)=>({day:accumDays.length+i+1,option:50,diamonds:10000000}));
      const both = { name:'累计+连续 (吃满两项)', cost:accumCost+extraCost, diamonds:acc.finalWithReward+CONSEC_REWARD_TOTAL, efficiency:(acc.finalWithReward+CONSEC_REWARD_TOTAL)/((accumCost+extraCost)*10000), schedule:[...accumDays,...extraList], insideBudget:(accumCost+extraCost)<=budget };

      const bigPlans = rechargeOptions.filter(o=>o.cost<=budget*10).map(o=>({ name:`直接买单包 ${o.cost} 元`, cost:o.cost, diamonds:o.diamonds+(o.diamonds>=target?ACCUM_REWARD:0), efficiency:(o.diamonds+(o.diamonds>=target?ACCUM_REWARD:0))/(o.cost*10000), schedule:[{day:1,option:o.cost,diamonds:o.diamonds}], insideBudget:o.cost<=budget }));

      return [onlyAcc,onlyConsec,both,...bigPlans];
    }

    function render(){
      const budget = Number(document.getElementById('budgetInput').value) || 0;
      const target = Number(document.getElementById('accumTargetInput').value) || 100000000;
      const plans = calculatePlans(budget,target);

      const container = document.getElementById('plansContainer');
      container.innerHTML='';
      plans.forEach(p=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML=`<strong>${p.name}</strong>`;
        const ul = document.createElement('ul');
        ul.innerHTML=`<li>花费：${p.cost} 元</li><li>总钻石（含奖励）： ${formatDiamonds(p.diamonds)}</li><li>单位成本： ${p.efficiency.toFixed(5)} 元/万钻</li>`;
        card.appendChild(ul);
        const schTitle=document.createElement('div'); schTitle.className='muted'; schTitle.textContent='逐日购买明细：'; card.appendChild(schTitle);
        const sch=document.createElement('ul'); p.schedule.forEach(s=>{const li=document.createElement('li'); li.textContent=`第${s.day}天：买 ${s.option} 档 → ${formatDiamonds(s.diamonds)}`; sch.appendChild(li);}); card.appendChild(sch);
        container.appendChild(card);
      });

      const rc = document.getElementById('rankingContainer'); rc.innerHTML='';
      const ranking = plans.slice().sort((a,b)=>b.diamonds-a.diamonds||a.cost-b.cost);
      if(ranking.length){
        const table=document.createElement('table');
        const thead=document.createElement('thead');
        thead.innerHTML='<tr><th>方案</th><th>花费</th><th>总钻石</th><th>单位成本</th><th>是否在预算内</th></tr>';
        table.appendChild(thead);
        const tbody=document.createElement('tbody');
        ranking.forEach((p,idx)=>{
          const tr=document.createElement('tr'); if(idx===0) tr.className='best';
          tr.innerHTML=`<td>${p.name}</td><td>${p.cost} 元</td><td>${formatDiamonds(p.diamonds)}</td><td>${p.efficiency.toFixed(5)} 元/万钻</td><td class='${p.insideBudget?'insideBudget':'overBudget'}'>${p.insideBudget?'✅':'❌'}</td>`;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody); rc.appendChild(document.createElement('div')).appendChild(table);
      }
    }

    document.getElementById('calcBtn').addEventListener('click', render);
    window.addEventListener('load', render);
  </script>
</body>
</html>
