<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- 载入 footer 样式 -->
  <link rel="stylesheet" href="/footer.css" />
  <!-- 载入 footer 样式 -->
  <title>天命神装合成器</title>
  <style>
    body {
      font-family: "Microsoft Yahei", sans-serif;
      max-width: 720px;
      margin: 20px auto;
      padding: 20px;
      background: #f0f0f0;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }
    select, button, input[type="number"] {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #3498db;
      color: white;
      margin-top: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .tab {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .tab button { width: 48%; }
    .section {
      display: none;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
    .active { display: block; }
    #result, #output {
      margin-top: 20px;
      padding: 15px;
      background: #e8f5e9;
      border-left: 6px solid #2e7d32;
    }
    .hint {
      margin-top: 12px;
      padding: 12px;
      background: #e3f2fd;
      border-left: 6px solid #1565c0;
    }
    @media (max-width: 480px) {
      body { padding: 10px; }
    }
  </style>
</head>
<body>

<h1>天命神装合成器</h1>

<div class="tab">
  <button onclick="switchTab('wholeSet')">整套计算</button>
  <button onclick="switchTab('singlePart')">单部位查询</button>
</div>

<!-- 整套计算功能 -->
<div id="wholeSet" class="section active">
  <label for="startStage">起始阶数：</label>
  <select id="startStage"></select>

  <label for="endStage">目标阶数：</label>
  <select id="endStage"></select>

  <label style="display:flex;align-items:center;gap:8px;font-weight:normal;margin-top:14px;">
    <input type="checkbox" id="includeRewards" />
    在新服七天内（自动计算需抽奖次数）
  </label>

  <button onclick="calculateSet()">计算整套消耗</button>

  <div id="result"></div>
</div>

<!-- 单部位查询功能 -->
<div id="singlePart" class="section">
  <label for="part">选择部位：</label>
  <select id="part">
    <option value="盔">盔</option>
    <option value="戒">戒</option>
    <option value="带">带</option>
    <option value="链">链</option>
    <option value="镯">镯</option>
    <option value="靴">靴</option>
    <option value="兵">兵</option>
    <option value="甲">甲</option>
  </select>

  <label for="startSingle">起始阶数：</label>
  <select id="startSingle"></select>

  <label for="endSingle">目标阶数：</label>
  <select id="endSingle"></select>

  <button onclick="calculatePart()">计算部位消耗</button>

  <div id="output"></div>
</div>

<script>
  // —— 升阶消耗表（保持你原来的数据） ——
  const costTable = {
    2: { normal: 200, soldier: 400 },
    3: { normal: 400, soldier: 400 },
    4: { normal: 700, soldier: 1400 },
    5: { normal: 1200, soldier: 2400 },
    6: { normal: 2400, soldier: 2400 },
    7: { normal: 3200, soldier: 3200 },
    8: { normal: 3200, soldier: 3200 },
    9: { normal: 5000, soldier: 6500 },
    10: { normal: 6000, soldier: 7500 }
  };

  // —— 你提供的抽奖/寻宝累计奖励（原样接入） ——
  const milestoneRewards = {
    1000: 1800,
    1500: 2700,
    2500: 4500,
    3000: 5400,
    4000: 7200,
    4500: 8100,
    5000: 11520,
    5500: 15120,
    6000: 17820,
    6500: 21420,
    7000: 23400,
    7500: 29520,
    8000: 33120,
    8500: 40500,
    9000: 45000,
    9500: 58320,
    10000: 79920,
    20000: 90000
  };

  // 预先按“累计奖励”升序排序，确保按你的数据精确反推最小需要抽次数
  const milestonesByDiamondsAsc = Object.entries(milestoneRewards)
    .map(([times, diamonds]) => ({ times: Number(times), diamonds: Number(diamonds) }))
    .sort((a, b) => a.diamonds - b.diamonds);

  function populateSelect(id, min = 1, max = 10) {
    const select = document.getElementById(id);
    select.innerHTML = "";
    for (let i = min; i <= max; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `${i}阶`;
      select.appendChild(opt);
    }
  }

  populateSelect("startStage");
  populateSelect("endStage");
  populateSelect("startSingle");
  populateSelect("endSingle");

  function switchTab(tabId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
  }

  function isSoldier(part) {
    return part === "兵" || part === "甲";
  }

  // 根据“所需宝钻”找到最小满足的抽奖次数（按你给的累计奖励）
  function findRequiredDraws(need) {
    if (need <= 0) return { times: 0, diamonds: 0 };
    for (const m of milestonesByDiamondsAsc) {
      if (m.diamonds >= need) return m; // 返回第一个满足的（最小累计奖励 → 最小所需抽次数）
    }
    return null; // 超过最大奖励（抽满 20000 次也不够）
  }

  function calculateSet() {
    const start = parseInt(document.getElementById("startStage").value);
    const end = parseInt(document.getElementById("endStage").value);
    const resultDiv = document.getElementById("result");

    if (end <= start) {
      resultDiv.innerHTML = "<strong>目标阶数必须大于起始阶数。</strong>";
      return;
    }

    let total = 0;
    for (let i = start + 1; i <= end; i++) {
      const c = costTable[i];
      if (!c) continue;
      const normal = c.normal * 8; // 8 件：盔、戒×2、带、链、镯×2、靴
      const soldier = (i >= 2) ? c.soldier * 2 : 0; // 兵 + 甲
      total += normal + soldier;
    }

    let html = `从 <strong>${start}阶</strong> 到 <strong>${end}阶</strong><br/>
      整套装备需要天命宝钻总数：<strong>${total.toLocaleString()}</strong> 个`;

    // 在新服七天内：自动提示至少需要抽多少次
    if (document.getElementById("includeRewards").checked) {
      const need = total;
      const milestone = findRequiredDraws(need);
      html += `<div class="hint"><strong>新服七天内奖励计算</strong><br/>`;
      if (milestone) {
        const extra = milestone.diamonds - need;
        html += `为满足 <strong>${need.toLocaleString()}</strong> 个宝钻，至少需要抽奖
          <strong>${milestone.times.toLocaleString()}</strong> 次（累计可得 <strong>${milestone.diamonds.toLocaleString()}</strong> 个）。<br/>`;
        if (extra > 0) {
          html += `可满足整套需求，并多出 <strong>${extra.toLocaleString()}</strong> 个。`;
        } else {
          html += `刚好满足整套需求。`;
        }
      } else {
        const max = milestonesByDiamondsAsc[milestonesByDiamondsAsc.length - 1];
        const lack = need - max.diamonds;
        html += `即使抽满 <strong>${max.times.toLocaleString()}</strong> 次（累计 <strong>${max.diamonds.toLocaleString()}</strong> 个），
          仍不足以完成整套，还差 <strong>${lack.toLocaleString()}</strong> 个。`;
      }
      html += `</div>`;
    }

    resultDiv.innerHTML = html;
  }

  function calculatePart() {
    const part = document.getElementById("part").value;
    const start = parseInt(document.getElementById("startSingle").value);
    const end = parseInt(document.getElementById("endSingle").value);
    const outputDiv = document.getElementById("output");

    if (end <= start) {
      outputDiv.innerHTML = "<strong>目标阶数必须大于起始阶数。</strong>";
      return;
    }

    let total = 0;
    for (let i = start + 1; i <= end; i++) {
      const c = costTable[i];
      if (!c) continue;
      total += isSoldier(part) ? c.soldier : c.normal;
    }

    outputDiv.innerHTML = `${part} 从 <strong>${start}阶</strong> 到 <strong>${end}阶</strong><br/>
      需要天命宝钻：<strong>${total.toLocaleString()}</strong> 个`;
  }
</script>

<!-- Footer -->
<div class="footer-wrapper">
  <footer id="footer-container">加载中...</footer>
</div>
<script src="/load-footer.js"></script>
<!-- footer -->
</body>
</html>
