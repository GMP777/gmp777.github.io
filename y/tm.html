<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>天命神装合成器</title>
  <!-- 载入 footer 样式 -->
<link rel="stylesheet" href="/footer.css" />
<!-- 载入 footer 样式 -->
  <style>
    body { font-family: "Microsoft Yahei", sans-serif; max-width: 720px; margin: 20px auto; padding: 20px; background: #f0f0f0; color: #333; }
    h1 { text-align: center; color: #2c3e50; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    select, button { width: 100%; padding: 10px; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; }
    button { background-color: #3498db; color: white; margin-top: 16px; cursor: pointer; }
    button:hover { background-color: #2980b9; }
    .tab { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
    .tab button { width: 48%; }
    .section { display: none; background: #fff; padding: 20px; border-radius: 10px; margin-top: 20px; }
    .active { display: block; }
    #result, #output { margin-top: 20px; padding: 15px; background: #e8f5e9; border-left: 6px solid #2e7d32; }
    .checkbox-container { margin-top: 12px; }
  </style>
</head>
<body>

<h1>天命神装合成器</h1>

<div class="tab">
  <button onclick="switchTab('wholeSet')">整套计算</button>
  <button onclick="switchTab('singlePart')">单部位查询</button>
</div>

<div id="wholeSet" class="section active">
  <label for="startStage">起始阶数：</label>
  <select id="startStage"></select>

  <label for="endStage">目标阶数：</label>
  <select id="endStage"></select>

  <div class="checkbox-container">
    <input type="checkbox" id="newServer" />
    <label for="newServer">新服抽抽乐</label>
    <div id="sevenDaysReward" style="margin-top:6px; color:#2e7d32;"></div>
  </div>

  <button onclick="calculateSet()">计算整套消耗</button>

  <div id="result"></div>
</div>

<div id="singlePart" class="section">
  <label for="part">选择部位：</label>
  <select id="part">
    <option value="盔">盔</option>
    <option value="戒">戒</option>
    <option value="带">带</option>
    <option value="链">链</option>
    <option value="镯">镯</option>
    <option value="靴">靴</option>
    <option value="兵">兵</option>
    <option value="甲">甲</option>
  </select>

  <label for="startSingle">起始阶数：</label>
  <select id="startSingle"></select>

  <label for="endSingle">目标阶数：</label>
  <select id="endSingle"></select>

  <button onclick="calculatePart()">计算部位消耗</button>

  <div id="output"></div>
</div>

<script>
const costTable = {
  2: { normal: 200, soldier: 400 },
  3: { normal: 400, soldier: 400 },
  4: { normal: 700, soldier: 1400 },
  5: { normal: 1200, soldier: 2400 },
  6: { normal: 2400, soldier: 2400 },
  7: { normal: 3200, soldier: 3200 },
  8: { normal: 3200, soldier: 3200 },
  9: { normal: 5000, soldier: 6500 },
  10: { normal: 6000, soldier: 7500 }
};

// 七天最佳奖励
const sevenDaysRewards = [1800, 2700, 4500, 5400, 7200, 8100, 11520];

function populateSelect(id, min=1, max=10){
  const sel=document.getElementById(id);
  sel.innerHTML="";
  for(let i=min;i<=max;i++){
    const opt=document.createElement("option");
    opt.value=i;
    opt.textContent=`${i}阶`;
    sel.appendChild(opt);
  }
}

populateSelect("startStage");
populateSelect("endStage");
populateSelect("startSingle");
populateSelect("endSingle");

function switchTab(tabId){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
}

function isSoldier(part){ return part==="兵"||part==="甲"; }

function calculateSet(){
  const start=parseInt(document.getElementById("startStage").value);
  const end=parseInt(document.getElementById("endStage").value);
  const resultDiv=document.getElementById("result");
  const sevenDays=document.getElementById("newServer").checked;

  if(end<=start){
    resultDiv.innerHTML="<strong>目标阶数必须大于起始阶数。</strong>";
    return;
  }

  let total=0;
  for(let i=start+1;i<=end;i++){
    const c=costTable[i];
    if(!c) continue;
    const normal=c.normal*8;
    const soldier=(i>=2)? c.soldier*2:0;
    total+=normal+soldier;
  }

  let rewardInfo="";
  if(sevenDays){
    const cumulativeRewards=[];
    let sum=0;
    for(let r of sevenDaysRewards){
      sum+=r;
      cumulativeRewards.push(sum);
    }

    let remaining=total;
    let drawsNeeded=0;
    for(let i=0;i<cumulativeRewards.length;i++){
      if(cumulativeRewards[i]>=total){
        drawsNeeded=i+1; 
        remaining=0;
        break;
      }
    }
    if(remaining>0){ 
      // 超过七天奖励的总和，用最后一次奖励平均估算剩余次数
      const lastReward=sevenDaysRewards[sevenDaysRewards.length-1];
      drawsNeeded=sevenDaysRewards.length + Math.ceil((total - cumulativeRewards[sevenDaysRewards.length-1]) / lastReward);
    }

    const sevenTotal=cumulativeRewards[cumulativeRewards.length-1];
    rewardInfo=`<br/><strong>新服抽抽乐七天奖励天命宝钻总和：${sevenTotal.toLocaleString()}</strong><br/>
                还需抽奖约 <strong>${drawsNeeded}</strong> 天才能集齐整套10阶`;
  }

  resultDiv.innerHTML=`从 <strong>${start}阶</strong> 到 <strong>${end}阶</strong><br/>
    整套装备需要天命宝钻总数：<strong>${total.toLocaleString()}</strong> 个${rewardInfo}`;
}

function calculatePart(){
  const part=document.getElementById("part").value;
  const start=parseInt(document.getElementById("startSingle").value);
  const end=parseInt(document.getElementById("endSingle").value);
  const outputDiv=document.getElementById("output");

  if(end<=start){
    outputDiv.innerHTML="<strong>目标阶数必须大于起始阶数。</strong>";
    return;
  }

  let total=0;
  for(let i=start+1;i<=end;i++){
    const c=costTable[i];
    if(!c) continue;
    total+=isSoldier(part)? c.soldier: c.normal;
  }

  outputDiv.innerHTML=`${part} 从 <strong>${start}阶</strong> 到 <strong>${end}阶</strong><br/>
    需要天命宝钻：<strong>${total.toLocaleString()}</strong> 个`;
}
</script>
  <!-- Footer -->
  <div class="footer-wrapper">
    <footer id="footer-container">加载中...</footer>
  </div>
  <script src="/load-footer.js"></script>
<!-- footer -->
</body>
</html>
