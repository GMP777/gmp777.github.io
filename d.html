<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ—“</title>
  <link rel="stylesheet" href="/footer.css" />
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .button-group-wrapper { margin-bottom: 20px; }
    .group-title {
      font-weight: bold;
      margin: 10px 0 5px;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .button-group button {
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      background: #fff;
      border: 1px solid #888;
      border-radius: 5px;
    }
    .button-group button.active {
      background: #337ab7;
      color: #fff;
      border-color: #337ab7;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 10px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    .highlight {
      background-color: #d1ffd1;
    }
    @media (max-width: 600px) {
      .button-group { flex-direction: column; }
      table, th, td { font-size: 0.9rem; }
    }
    a {
      color: #337ab7;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="button-group-wrapper" id="buttonGroups"></div>

  <table id="accountTable">
    <thead>
      <tr>
        <th>å¹³å°</th>
        <th>å¤‡æ³¨</th>
        <th>åˆ›å»ºæ—¥æœŸ</th>
        <th>çŠ¶æ€</th>
        <th>æ¸¸æˆé“¾æ¥</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // ---- é…ç½® ----
    const serverGroups = {
      "115": ["115", "114","113",  "112", "111","110", "108", "107", "105", "104"]
    };

    const platforms = {
      "xayxms": { base: "http://gm.xayxms.cn", account: "xxxx" },
      "395wan": { base: "http://game.395wan.com", account: "qqq,aaa" },
      "8kyou": { base: "http://www.8kyou.com:81", account: "aaa1-5" },
      "99yn": { base: "http://gm.99yn.cn", account: "qqq" }
    };

    const serverAccounts = {
      "112": [
        { name: "8kyou",  status: "not" },
        { name: "395wan", date: "2025-07-31"},
        { name: "xayxms", status: "not" }
      ],
      "111": [
        { name: "8kyou", date: "2025-08-06", tag: "a1-5" },
        { name: "395wan", date: "2025-08-03", tag: "q2-9,a1-9" },
        { name: "xayxms", date: "2025-08-03" }
      ],
      "113": [
        { name: "8kyou", date: "2025-08-06", status: "not"},
        { name: "395wan", date: "2025-08-05", tag: "q" },
        { name: "395wan", date: "2025-08-06", tag: "a" },
        { name: "xayxms", date: "2025-08-03" }
      ],
      "114": [
        { name: "8kyou", date: "2025-08-07", status: "not"},
        { name: "395wan", date: "2025-08-07"},
        { name: "xayxms", date: "2025-08-07" }
      ],
      "115": [
        { name: "8kyou", date: "2025-08-15"},
        { name: "395wan", date: "2025-08-15"},
        { name: "xayxms", date: "2025-08-15" }
      ],
      "116": [
        { name: "8kyou", date: "2025-08-17"},
        { name: "395wan", date: "2025-08-17"},
        { name: "xayxms", date: "2025-08-17" }
      ]
    };

    // ---- ç»„è£…æŒ‰é’® ----
    const gameConfigs = [];
    Object.entries(serverGroups).forEach(([gameId, servers]) => {
      servers.forEach(server => gameConfigs.push({ gameId, server }));
    });

    let currentGame = gameConfigs[0];

    function createGroupedButtons() {
      const container = document.getElementById('buttonGroups');
      container.innerHTML = '';
      const grouped = {};

      gameConfigs.forEach(cfg => {
        if (!grouped[cfg.gameId]) grouped[cfg.gameId] = [];
        grouped[cfg.gameId].push(cfg);
      });

      Object.keys(grouped).forEach(gameId => {
        const title = document.createElement('div');
        title.className = 'group-title';
        title.textContent = 'æ¸¸æˆ ' + gameId;
        container.appendChild(title);

        const groupDiv = document.createElement('div');
        groupDiv.className = 'button-group';

        grouped[gameId].forEach(cfg => {
          const btn = document.createElement('button');
          btn.textContent = `${cfg.gameId}-${cfg.server}`;
          btn.onclick = () => {
            currentGame = cfg;
            document.querySelectorAll('.button-group button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderTable();
          };
          if (cfg === currentGame) btn.classList.add('active');
          groupDiv.appendChild(btn);
        });

        container.appendChild(groupDiv);
      });
    }

    // ---- æ—¶é—´ä¸å¤©æ•°è®¡ç®—ï¼ˆç»Ÿä¸€æŒ‰ UTC+8ï¼‰----
    const MS_PER_DAY = 24 * 60 * 60 * 1000;

    // å°†å½¢å¦‚ 2025-08-15 çš„æ—¥æœŸè§†ä¸º UTC+8 çš„ 00:00ï¼Œå¹¶è¿”å›å¯¹åº”çš„æ—¶é—´ç‚¹
    function parseDateUTC8(str) {
      const [y, m, d] = str.split('-').map(Number);
      return new Date(Date.UTC(y, m - 1, d) - 8 * 60 * 60 * 1000);
    }

    // è·å–â€œä»Šå¤©â€åœ¨ UTC+8 çš„ 00:00 å¯¹åº”çš„æ—¶é—´ç‚¹
    function getTodayStartUTC8() {
      const now = new Date();
      // æŠŠå½“å‰æ—¶åˆ»å¹³ç§»åˆ°â€œUTC+8 çš„æ—¶é’Ÿâ€ï¼Œå†å–å…¶ UTC* å­—æ®µ
      const shifted = new Date(now.getTime() + 8 * 60 * 60 * 1000);
      const y = shifted.getUTCFullYear();
      const m = shifted.getUTCMonth() + 1;
      const d = shifted.getUTCDate();
      // ç”¨åŒæ ·è§„åˆ™ç”Ÿæˆâ€œä»Šå¤© 00:00 (UTC+8)â€
      const mm = String(m).padStart(2, '0');
      const dd = String(d).padStart(2, '0');
      return parseDateUTC8(`${y}-${mm}-${dd}`);
    }

    function renderTable() {
      const { gameId, server } = currentGame;
      const todayStart = getTodayStartUTC8(); // ä»¥å¤©ä¸ºå•ä½ï¼Œé¿å…å› å°æ—¶å¯¼è‡´çš„åå·®
      const tbody = document.querySelector('#accountTable tbody');
      tbody.innerHTML = '';

      const list = serverAccounts[server] || [];
      if (list.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5">è¯¥åŒºæœæ— å¹³å°æ•°æ®</td></tr>`;
        return;
      }

      list.forEach(({ name, date, tag, status }) => {
        const platform = platforms[name];
        if (!platform) return;

        const remark = tag || platform.account || 'â€”';
        const url = `${platform.base}/login/${gameId}/${server}.html`;

        let dayStatus = 'â€”';
        let isHighlight = false;

        if (status === 'not') {
          dayStatus = 'âŒ æœªæ³¨å†Œ';
        } else if (date) {
          const createDate = parseDateUTC8(date);
          // å…³é”®ä¿®å¤ï¼šä»¥â€œUTC+8 çš„æ•´å¤©â€ä¸ºå•ä½è¿›è¡Œå·®å€¼ï¼Œå† +1
          let days = Math.floor((todayStart - createDate) / MS_PER_DAY) + 1;
          if (days < 1) days = 1; // é˜²å®ˆï¼šæœªæ¥æ—¥æœŸæ—¶è‡³å°‘æ˜¾ç¤ºç¬¬ 1 å¤©

          if (days === 3) {
            dayStatus = 'ğŸ¡ å¯æŠ½å¥–';
            isHighlight = true;
          } else if (days > 3) {
            dayStatus = 'âœ… å·²å®Œæˆ';
          } else {
            dayStatus = `ç¬¬ ${days} å¤© â³`;
          }
        }

        const tr = document.createElement('tr');
        if (isHighlight) tr.classList.add('highlight');

        tr.innerHTML = `
          <td>${name}</td>
          <td>${remark}</td>
          <td>${date || 'â€”'}</td>
          <td>${dayStatus}</td>
          <td><a href="${url}" target="_blank">è¿›å…¥æ¸¸æˆ</a></td>
        `;
        tbody.appendChild(tr);
      });
    }

    createGroupedButtons();
    renderTable();
  </script>

  <div class="footer-wrapper">
    <footer id="footer-container">åŠ è½½ä¸­...</footer>
  </div>
  <script src="/load-footer.js"></script>
</body>
</html>
