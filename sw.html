<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åœ£ç‹ä¼ å¥‡ - ç‚¹å‡»å¤åˆ¶é“¾æ¥</title>
  <link rel="stylesheet" href="/footer.css" />
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#06b6d4;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, Roboto, "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,#071025 0%, #0b1a2a 100%);
      color:#e6eef8; min-height:100vh; padding:20px;
    }
    .wrap{max-width:900px; margin:0 auto}
    header{text-align:center; margin-bottom:24px}
    header h1{font-size:22px; margin:0 0 6px 0}
    header p{margin:0; color:var(--muted); font-size:14px}

    .mode-buttons {
      display:flex;
      justify-content:center;
      gap:10px;
      margin-bottom:16px;
      flex-wrap:wrap;
    }
    .mode-btn {
      background:rgba(255,255,255,0.08);
      color:#e6eef8;
      border:none;
      border-radius:999px;
      padding:8px 16px;
      cursor:pointer;
      font-weight:600;
      transition:background .15s ease, transform .1s ease;
    }
    .mode-btn:hover {background:rgba(255,255,255,0.12);}
    .mode-btn:active {transform:scale(0.98);}
    .mode-btn.active {
      background:linear-gradient(90deg,var(--accent),#7dd3fc);
      color:#022;
    }

    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:14px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius); padding:18px; cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset, 0 6px 18px rgba(2,6,23,0.6);
      text-align:center;
    }
    .card:hover{box-shadow:0 8px 26px rgba(6,182,212,0.25)}
    .card:active{transform:translateY(1px)}
    .title{
      font-weight:700; font-size:18px; color:#fff; margin-bottom:6px;
      display:flex; justify-content:center; align-items:center; flex-wrap:wrap; gap:6px;
    }
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      font-size:12px; font-weight:700; border-radius:999px;
      padding:2px 6px; box-shadow:0 1px 3px rgba(0,0,0,0.3);
    }
    .badge-new{background:#06b6d4; color:#022;}
    .badge-guild{background:#facc15; color:#222;}
    .badge-diamond{background:#38bdf8; color:#022;}
    .badge-merge{background:linear-gradient(90deg,#ef4444,#dc2626); color:#fff;}
    .info{font-size:13px; color:var(--muted)}

    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:28px; background:linear-gradient(90deg,var(--accent),#7dd3fc);
      color:#022; padding:10px 16px; border-radius:999px;
      box-shadow:0 6px 24px rgba(6,22,34,0.6); font-weight:600;
      display:none; z-index:999;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>åœ£ç‹ä¼ å¥‡æœåŠ¡å™¨åˆ—è¡¨</h1>
      <p>ç‚¹å‡»å¡ç‰‡æ“ä½œæ–¹å¼å¯åˆ‡æ¢ï¼šå¤åˆ¶é“¾æ¥ / æ–°çª—å£æ‰“å¼€</p>
    </header>

    <div class="mode-buttons">
      <button id="copyMode" class="mode-btn active">ğŸ“‹ ç‚¹å‡»å¤åˆ¶é“¾æ¥</button>
      <button id="openMode" class="mode-btn">ğŸŒ æ–°çª—å£æ‰“å¼€é“¾æ¥</button>
      <button id="refreshBtn" class="mode-btn">ğŸ”„ å¼ºåˆ¶åˆ·æ–°çŠ¶æ€</button>
    </div>

    <div class="grid" id="cardContainer"></div>
  </div>

  <div id="toast" class="toast">å·²å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿</div>

  <script>
    // === æœåŠ¡å™¨æ•°æ® è‡ªåŠ¨ç”Ÿæˆ 2091~2111ï¼ˆä¿®æ­£ï¼šæŒ‰åŒ—äº¬æ—¶é—´æ ¼å¼åŒ–æ—¥æœŸï¼Œé¿å… UTC åç§»ï¼‰ ===
    const servers = [];
    const baseServerId = 98471;
    const baseServerNum = 2091;
    // baseDate è¡¨ç¤ºâ€œåŒ—äº¬æ—¶é—´ 2025-10-06 00:00:00â€
    const baseDate = new Date("2025-10-06T00:00:00+08:00");

    // helperï¼šæŠŠä¸€ä¸ªæ—¶é—´æˆ³æ ¼å¼åŒ–ä¸ºåŒ—äº¬æ—¶é—´çš„ YYYY-MM-DD å­—ç¬¦ä¸²
    function formatDateBeijingYYYYMMDD(ms) {
      // ä½¿ç”¨ toLocaleDateString æŒ‡å®šæ—¶åŒºä¸º Asia/Shanghaiï¼Œen-CA è¿”å› YYYY-MM-DD æ ¼å¼
      return new Date(ms).toLocaleDateString('en-CA', { timeZone: 'Asia/Shanghai' });
    }

    for (let i = 0; i <= 20; i++) { // 2091 ~ 2111 å…±21ä¸ª
      const serverNum = baseServerNum + i;
      const serverId = baseServerId + i;
      const ms = baseDate.getTime() + i * 24 * 60 * 60 * 1000;
      const openDateStr = formatDateBeijingYYYYMMDD(ms); // æ­£ç¡®çš„åŒ—äº¬æ—¶é—´æ—¥æœŸå­—ç¬¦ä¸²
      servers.push({
        id: serverNum,
        url: `http://www.9awan.com/game.php?action=play&game_id=283&server_id=${serverId}`,
        openDate: openDateStr
      });
    }

    const mergedRange = { from: 2091, to: 2097 };
    const mergeStart = new Date("2025-10-18T00:00:00+08:00"); // åˆæœå¼€å§‹ï¼ˆç¬¬1å¤©ï¼‰

    const container = document.getElementById('cardContainer');
    const toast = document.getElementById('toast');
    const refreshBtn = document.getElementById('refreshBtn');

    let currentMode = 'copy'; // é»˜è®¤å¤åˆ¶æ¨¡å¼

    // === è·å–åŒ—äº¬æ—¶é—´ï¼ˆç²¾ç¡®ï¼‰ ===
    function getBeijingNow() {
      const now = new Date();
      const utcMs = now.getTime() + now.getTimezoneOffset() * 60 * 1000;
      const beijingMs = utcMs + 8 * 60 * 60 * 1000;
      return new Date(beijingMs);
    }

    // è¿”å›åŒ—äº¬æ—¶é—´å½“å¤© 00:00:00 çš„ Dateï¼ˆç”¨äºæŒ‰åŒ—äº¬æ—¶é—´çš„â€œæ—¥â€æ¥è®¡ç®—ï¼‰
    function getBeijingStartOfToday() {
      const now = getBeijingNow();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      return new Date(`${y}-${m}-${d}T00:00:00+08:00`);
    }

    // === æ¸²æŸ“å¡ç‰‡ï¼ˆä»¥åŒ—äº¬æ—¶é—´é›¶ç‚¹ä¸ºåŸºå‡†è®¡ç®—å¤©æ•°ï¼‰ ===
    function renderCards() {
      container.innerHTML = '';
      const beijingTodayStart = getBeijingStartOfToday();
      const now = getBeijingNow();
      const todayWeekday = now.getDay(); // 0=å‘¨æ—¥,1=å‘¨ä¸€,...

      const MS_PER_DAY = 24 * 60 * 60 * 1000;

      servers.forEach(server => {
        // æœåŠ¡å™¨å¼€æœæ—¥çš„åŒ—äº¬é›¶ç‚¹æ—¶é—´
        const openDateStart = new Date(server.openDate + "T00:00:00+08:00");
        // ç”¨ã€ŒåŒ—äº¬é›¶ç‚¹ã€ä½œåŸºå‡†å¤©æ•°å·®ï¼šä¿è¯åœ¨åŒ—äº¬æ—¶é—´ 00:00 åˆ‡æ¢
        const diffDays = Math.floor((beijingTodayStart.getTime() - openDateStart.getTime()) / MS_PER_DAY);

        let infoText = '';
        let icons = '';

        if (diffDays < 0) {
          // è¿˜æ²¡å¼€æœï¼šå€’è®¡æ—¶æŒ‰å¤©è®¡ç®—ï¼ˆå¼€æœæ—¥ä¸ºç¬¬1å¤©ï¼‰
          infoText = `å¼€æœå€’è®¡æ—¶ ${Math.abs(diffDays)} å¤©`;
        } else if (diffDays < 7) {
          // å¼€æœç¬¬ N å¤©ï¼ˆå¼€æœå½“å¤© diffDays==0 -> ç¬¬1å¤©ï¼‰
          infoText = `å¼€æœç¬¬ ${diffDays + 1} å¤©`;
        } else {
          infoText = `å¼€æœå…± ${diffDays + 1} å¤©`;
        }

        // æ–°æœï¼šä¸¥æ ¼å½“å¤©å¼€æœï¼ˆä»¥åŒ—äº¬é›¶ç‚¹ä¸ºå‡†ï¼‰
        if (diffDays === 0) icons += `<span class="badge badge-new">ğŸ†• æ–°æœ</span>`;

        // æˆ˜æ—¥é€»è¾‘ï¼ˆéåˆæœåŒºï¼‰
        if (!(server.id >= mergedRange.from && server.id <= mergedRange.to) && diffDays >= 3 && (todayWeekday === 3 || todayWeekday === 6)) {
          icons += `<span class="badge badge-diamond">ğŸ’ æˆ˜æ—¥</span>`;
        }

        // åˆæœåŒºå¤„ç†ï¼ˆç”¨å›ºå®š mergeStart ä¸åŒ—äº¬é›¶ç‚¹åŸºå‡†è®¡ç®—åˆæœç¬¬å‡ å¤©ï¼‰
        if (server.id >= mergedRange.from && server.id <= mergedRange.to) {
          const mergeDiffDays = Math.floor((beijingTodayStart.getTime() - mergeStart.getTime()) / MS_PER_DAY);
          const mergeDay = mergeDiffDays >= 0 ? mergeDiffDays + 1 : 0;
          icons += `<span class="badge badge-merge">âš”ï¸ åˆæœç¬¬ ${mergeDay} å¤©</span>`;
          if (mergeDay === 3) icons += `<span class="badge badge-guild">ğŸ‘‘ å…¬ä¼šæˆ˜</span>`;
        } else {
          if (diffDays === 2) icons += `<span class="badge badge-guild">ğŸ‘‘ å…¬ä¼šæˆ˜</span>`;
        }

        const card = document.createElement('div');
        card.className = 'card';
        card.tabIndex = 0;
        card.setAttribute('aria-label', `åœ£ç‹ä¼ å¥‡${server.id}æœï¼Œ${infoText}`);
        card.innerHTML = `
          <div class="title">åœ£ç‹ä¼ å¥‡${server.id}æœ ${icons}</div>
          <div class="info">${infoText}</div>
        `;

        card.addEventListener('click', () => handleCardClick(server.url));
        card.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            handleCardClick(server.url);
          }
        });

        container.appendChild(card);
      });
    }

    // === ç‚¹å‡»è¡Œä¸º ===
    function handleCardClick(url) {
      if (currentMode === 'copy') {
        copyText(url);
      } else {
        window.open(url, '_blank');
      }
    }

    // === æ¨¡å¼åˆ‡æ¢ ===
    const copyBtn = document.getElementById('copyMode');
    const openBtn = document.getElementById('openMode');
    copyBtn.addEventListener('click', () => switchMode('copy'));
    openBtn.addEventListener('click', () => switchMode('open'));

    function switchMode(mode) {
      currentMode = mode;
      if (mode === 'copy') {
        copyBtn.classList.add('active');
        openBtn.classList.remove('active');
      } else {
        openBtn.classList.add('active');
        copyBtn.classList.remove('active');
      }
    }

    // === å¼ºåˆ¶åˆ·æ–° ===
    refreshBtn.addEventListener('click', () => {
      renderCards();
      showToastMessage("å·²æ‰‹åŠ¨åˆ·æ–°çŠ¶æ€");
    });

    // === å¤åˆ¶åŠŸèƒ½ ===
    function copyText(text){
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => showToastMessage("å·²å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿")).catch(() => fallbackCopy(text));
      } else fallbackCopy(text);
    }
    function fallbackCopy(text){
      const ta = document.createElement('textarea');
      ta.value = text; ta.style.position='fixed'; ta.style.left='-9999px';
      document.body.appendChild(ta);
      ta.focus(); ta.select();
      try{document.execCommand('copy'); showToastMessage("å·²å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿");}catch(e){}
      ta.remove();
    }

    // === æç¤ºæ°”æ³¡ ===
    function showToastMessage(msg){
      toast.textContent = msg;
      toast.style.display='block'; toast.style.opacity='1';
      setTimeout(()=>{
        toast.style.transition='opacity 300ms ease'; toast.style.opacity='0';
        setTimeout(()=>toast.style.display='none',300);
      },1000);
    }

    // === æ¯å¤©åŒ—äº¬æ—¶é—´00:01è‡ªåŠ¨æ›´æ–°ï¼Œå¹¶æ¯12å°æ—¶å†æ›´æ–°ä¸€æ¬¡ ===
    function scheduleDailyRefresh() {
      const nowBeijing = getBeijingNow();
      const todayBeijingStart = getBeijingStartOfToday();
      // ä¸‹ä¸€ä¸ªåŒ—äº¬æ—¶é—´ 00:01 çš„æ—¶é—´æˆ³ = ä»Šå¤©åŒ—äº¬é›¶ç‚¹ + 24å°æ—¶ + 1åˆ†é’Ÿ
      const nextRefreshMs = todayBeijingStart.getTime() + 24 * 60 * 60 * 1000 + 1 * 60 * 1000;
      const msUntilNext = nextRefreshMs - nowBeijing.getTime();

      const initialDelay = msUntilNext > 0 ? msUntilNext : 1000;

      setTimeout(() => {
        renderCards();
        setInterval(renderCards, 12 * 60 * 60 * 1000);
      }, initialDelay);
    }

    // é¦–æ¬¡æ¸²æŸ“
    renderCards();
    scheduleDailyRefresh();
  </script>

  <div class="footer-wrapper">
    <footer id="footer-container">åŠ è½½ä¸­...</footer>
  </div>
  <script src="/load-footer.js"></script>
</body>
</html>
