<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>游戏区服列表</title>
  <!-- 载入 footer 样式 -->
<link rel="stylesheet" href="/footer.css" />
<!-- 载入 footer 样式 -->
<style>
body {
  font-family: "Microsoft Yahei", Arial, sans-serif;
  max-width: 900px; margin: 20px auto; padding: 16px;
  background: linear-gradient(180deg,#071025 0%,#0b1a2a 100%); color:#e6eef8;
}
h2 { text-align:center; margin-bottom:12px; }
.top-controls, .tabs { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:16px; }
.ctrl-btn, .tab-btn { cursor:pointer; border-radius:8px; padding:6px 12px; transition:0.3s; font-weight:600; }
.ctrl-btn { border:1px solid #28a745; color:#28a745; background:#0b1220; }
.ctrl-btn:hover { background:#28a745; color:#022; }
.tab-btn { border:1px solid #06b6d4; color:#06b6d4; background:#0b1220; }
.tab-btn.active, .tab-btn:hover { background:#06b6d4; color:#022; }

.grid-container { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px; justify-items:center; margin-bottom:30px; }
.grid-item { display:flex; flex-direction:column; align-items:center; text-align:center; gap:4px; }
.grid-item a { display:inline-block; padding:6px 10px; border:1px solid rgba(255,255,255,0.3); border-radius:6px; color:#06b6d4; text-decoration:none; transition:0.2s; white-space:nowrap; }
.grid-item a:hover { background:#06b6d4; color:#022; }

.badge { font-size:0.8em; border-radius:6px; padding:2px 6px; margin-top:2px; }
.badge-day { background:rgba(6,182,212,0.3); color:#022; }
.badge-event { background:rgba(250,205,21,0.3); color:#222; }

#toast { position:fixed; left:50%; transform:translateX(-50%); bottom:28px; background:linear-gradient(90deg,#06b6d4,#7dd3fc); color:#022; padding:10px 16px; border-radius:999px; box-shadow:0 6px 24px rgba(6,22,34,0.6); font-weight:600; display:none; z-index:999; }
#time { text-align:center; color:#9aa4b2; font-size:0.9em; margin-top:8px; }
</style>
</head>
<body>

<h2>🎮 游戏区服列表</h2>

<div class="top-controls">
  <button class="ctrl-btn" id="copyModeBtn">📋 复制模式</button>
  <button class="ctrl-btn" id="openModeBtn">🔗 打开模式</button>
  <button class="ctrl-btn" id="switchSiteBtn">🌐 当前：9awan</button>
</div>

<div class="tabs" id="tabs"></div>
<div id="tables"></div>
<div id="time"></div>
<div id="toast"></div>

<script>
let clickMode = "copy";
let currentSite = "9awan";

const swcqMergeRanges = [
  {from:2091, to:2097, mergeDate:new Date("2025-10-06")},
  {from:2098, to:2104, mergeDate:new Date("2025-10-18")}
];

const games = [
  {id:"swcq", name:"圣王传奇", type:"swcq", servers:[2091,2092,2093,2094,2095,2096,2097,2098,2099,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2111,2112,2113,2114,2115,2116]},
  {id:"xayxms", name:"悠久传奇", servers:[105,112,113,114,115,116,117,118,119,120,121,122,123], homepage1:"http://gm.yx4f.com:81/games/115.html", homepage2:"http://gm.962yx.com/games/115.html"},
  {id:"tmss", name:"屠神", servers:[25,26,30,31], homepage:"http://www.8syx.com/game/7/"}
];

// ---------- 工具 ----------
function showToast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.display="block";
  t.style.opacity="1";
  setTimeout(()=>{t.style.transition="opacity 300ms"; t.style.opacity="0"; setTimeout(()=>t.style.display="none",300);},1500);
}

function getBeijingNow(){ const now=new Date(); return new Date(now.getTime()+8*60*60*1000+now.getTimezoneOffset()*60*1000); }

function getMergeInfo(serverId){
  for(const r of swcqMergeRanges) if(serverId>=r.from&&serverId<=r.to) return r;
  return null;
}

// ---------- 渲染 ----------
const tabs = document.getElementById("tabs");
const tables = document.getElementById("tables");

function renderSWCQ(){
  const grid = document.createElement("div");
  grid.className="grid-container";
  grid.id="table-swcq";

  const card = document.createElement("div"); card.className="grid-item";
  const a = document.createElement("a");
  a.textContent="📅 开服表";
  a.href=currentSite==="9awan"?"http://www.9awan.com/home/server/283":"http://88.3uyy.com/home/server/283";
  a.target="_blank"; card.appendChild(a); grid.appendChild(card);

  const today = getBeijingNow();
  for(const s of games[0].servers){
    const item = document.createElement("div"); item.className="grid-item";
    const link = document.createElement("a"); link.textContent=`${s}区`;

    const merge = getMergeInfo(s);
    let diffDays = merge?Math.floor((today - merge.mergeDate)/(1000*3600*24))+1:0;
    link.onclick = e=>{ e.preventDefault();
      const url = `http://${currentSite}.com/game.php?action=play&game_id=283&server_id=${98470+s-2090}`;
      if(clickMode==="open") window.open(url,"_blank");
      else {navigator.clipboard.writeText(url); showToast("已复制链接");}
    };
    item.appendChild(link);

    if(diffDays>0){ 
      const b = document.createElement("div"); b.className="badge badge-day"; b.textContent=`合服第 ${diffDays} 天`; item.appendChild(b);
    }
    if(diffDays===3){ const b=document.createElement("div"); b.className="badge badge-event"; b.textContent="👑 城主战"; item.appendChild(b);}
    const weekday = today.getDay(); if(diffDays>3&&(weekday===3||weekday===6)){ const b=document.createElement("div"); b.className="badge badge-event"; b.textContent="🏰 公会战日"; item.appendChild(b);}
    grid.appendChild(item);
  }
  return grid;
}

function renderOtherGame(game){
  const grid=document.createElement("div"); grid.className="grid-container"; grid.id="table-"+game.id;
  grid.style.display="none";

  // 游戏主页或不同平台标识
  if(game.homepage1 && game.homepage2){
    const h1=document.createElement("div"); h1.className="grid-item";
    const a1=document.createElement("a"); a1.textContent="🏠 悠久传奇"; a1.href=game.homepage1; a1.target="_blank"; h1.appendChild(a1);
    grid.appendChild(h1);
    const h2=document.createElement("div"); h2.className="grid-item";
    const a2=document.createElement("a"); a2.textContent="🏠 962yx"; a2.href=game.homepage2; a2.target="_blank"; h2.appendChild(a2);
    grid.appendChild(h2);
  } else if(game.homepage){
    const h=document.createElement("div"); h.className="grid-item";
    const a=document.createElement("a"); a.textContent="🏠 游戏主页"; a.href=game.homepage; a.target="_blank"; h.appendChild(a); grid.appendChild(h);
  }

  for(const s of game.servers){
    const item=document.createElement("div"); item.className="grid-item";
    const a=document.createElement("a"); a.textContent=`${s}区`;
    a.onclick=e=>{ e.preventDefault(); const url=`http://gm.yx4f.com:81/login/${game.id}/${s}.html`; if(clickMode==="open") window.open(url,"_blank"); else {navigator.clipboard.writeText(url); showToast("已复制链接");} };
    item.appendChild(a); grid.appendChild(item);
  }
  return grid;
}

// ---------- 标签页 ----------
games.forEach((g,i)=>{
  const btn=document.createElement("button"); btn.className="tab-btn"+(i===0?" active":""); btn.textContent=g.name;
  btn.onclick=()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".grid-container").forEach(gc=>gc.style.display="none");
    const table = document.getElementById("table-"+g.id);
    table.style.display="grid";
  };
  tabs.appendChild(btn);
  if(g.id==="swcq") tables.appendChild(renderSWCQ());
  else tables.appendChild(renderOtherGame(g));
});

// ---------- 控制按钮 ----------
document.getElementById("copyModeBtn").onclick = ()=>{ clickMode="copy"; showToast("复制模式"); };
document.getElementById("openModeBtn").onclick = ()=>{ clickMode="open"; showToast("打开模式"); };
document.getElementById("switchSiteBtn").onclick = ()=>{
  currentSite=currentSite==="9awan"?"3uyy":"9awan";
  document.getElementById("switchSiteBtn").textContent=`🌐 当前：${currentSite}`;
  document.getElementById("table-swcq").replaceWith(renderSWCQ());
  showToast("已切换网站");
};

// ---------- 北京时间显示 ----------
function showTime(){ document.getElementById("time").textContent="北京时间："+getBeijingNow().toLocaleString("zh-CN",{hour12:false}); }
setInterval(showTime,1000); showTime();

</script>

<div class="footer-wrapper"><footer id="footer-container">加载中...</footer></div>
<script src="/load-footer.js"></script>
</body>
</html>
